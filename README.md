# 🤖 AI 对话系统

一个基于 **FastAPI + Vue 3** 的现代多会话 AI 聊天应用，集成 DeepSeek AI，支持消息管理、数据持久化和主题切换。

![Python](https://img.shields.io/badge/Python-3.8+-blue?logo=python)
![Vue](https://img.shields.io/badge/Vue-3-green?logo=vuedotjs)
![FastAPI](https://img.shields.io/badge/FastAPI-0.1.0-009688)
![Status](https://img.shields.io/badge/Status-Active-success)

---

## ✨ 核心特性

- 🎯 **多会话支持** - 创建、切换、删除独立的对话会话
- 💬 **消息管理** - 发送、删除、回滚消息操作
- 🤖 **AI 集成** - 集成 DeepSeek API 获取智能回复
- 💾 **数据持久化** - 自动保存所有数据到 JSON 文件
- 🎨 **主题切换** - 支持 4 种精美主题
- ⚡ **异步处理** - 快速响应，不阻塞用户交互
- 🎬 **淡出动画** - AI 回复自动淡出消失
- 📱 **响应式设计** - 支持各种屏幕尺寸
- ⌨️ **快捷键支持** - Enter 发送、Ctrl+Enter 换行

---

## 🚀 快速开始

### 前置要求
- Python 3.8+
- pip 包管理器
- 现代浏览器

### 安装

```bash
# 1. 克隆或进入项目目录
cd c:\Users\21222\Desktop\2304010519王培宇

# 2. 安装依赖
pip install fastapi uvicorn[standard] httpx

# 3. 启动服务
uvicorn main:app --reload --port 8000

# 4. 打开浏览器访问
http://127.0.0.1:8000
```

---

## 📖 项目结构

```
├── main.py                      # FastAPI 后端应用
├── index.html                   # 前端主页面
├── themes.js                    # 主题配置
├── background.png               # 背景图片
├── sessions.json                # 数据存储（自动生成）
│
├── js/
│   ├── app.js                  # Vue 3 应用逻辑
│   └── api.js                  # API 调用封装
│
├── css/
│   ├── main.css                # 主样式
│   └── themes.css              # 主题样式
│
├── ARCHITECTURE.md              # 系统架构文档
└── QUICK_REFERENCE.md          # 快速参考指南
```

---

## 🎮 使用指南

### 基本操作

| 功能 | 操作 |
|------|------|
| **创建会话** | 点击"＋ 新建会话" |
| **发送消息** | 输入文本 → 按 Enter 或点击发送 |
| **换行** | Ctrl + Enter |
| **删除消息** | 点击消息的"删除" |
| **回滚消息** | 点击"回滚到此处之前" |
| **删除会话** | 点击会话旁的"✕" |
| **切换主题** | 右上角主题下拉菜单 |

---

## 🏗️ 系统架构

### 三层架构设计

```
┌─────────────────────────────┐
│   表现层：Vue 3 + HTML/CSS  │  ← 用户界面
├─────────────────────────────┤
│  业务逻辑层：JavaScript     │  ← 状态、事件、API
├─────────────────────────────┤
│  数据访问层：FastAPI        │  ← API 服务、业务处理
├─────────────────────────────┤
│  存储层：JSON 文件          │  ← 数据持久化
└─────────────────────────────┘
```

### 数据流

```
用户操作 → Vue 事件 → API 调用 → HTTP 请求 → 后端处理
                                    ↓
                          数据存储 + AI 调用
                                    ↓
                          响应返回 → 状态更新 → UI 渲染
```

---

## 🔌 API 端点

### 会话管理

```
GET    /api/sessions              # 获取所有会话
POST   /api/sessions              # 创建新会话
DELETE /api/sessions/{id}         # 删除会话
```

### 消息管理

```
GET    /api/sessions/{id}/messages              # 获取消息
POST   /api/sessions/{id}/messages              # 发送消息
DELETE /api/sessions/{id}/messages/{index}      # 删除消息
POST   /api/sessions/{id}/rollback              # 回滚消息
```

---

## 🛠️ 技术栈

### 后端
- **FastAPI** - 高性能异步 Web 框架
- **Uvicorn** - ASGI 应用服务器
- **Pydantic** - 数据验证
- **httpx** - 异步 HTTP 客户端
- **Python 3.8+**

### 前端
- **Vue 3** - 响应式前端框架
- **HTML5** - 页面结构
- **CSS3** - 样式与动画
- **Fetch API** - HTTP 请求

### 数据存储
- **JSON** - 轻量级数据持久化
- **文件系统** - 本地存储

---

## 🎨 主题

系统内置 4 种精美主题：

| 主题 | 特点 |
|------|------|
| **默认主题** | 蓝绿色冷色系，适合长时间使用 |
| **粉色主题** | 粉紫氛围，更活泼可爱 |
| **暗夜主题** | 更深的暗色，对比更强，适合夜间 |
| **黄金主题** | 金色高亮，适合展示效果 |

---

## 💡 功能详解

### 多会话支持
- 用户可创建多个独立的对话会话
- 每个会话有独立的消息历史
- 会话自动按更新时间排序

### 消息操作
- **发送消息**：立即显示用户消息，异步获取 AI 回复
- **删除消息**：删除单条消息，刷新消息列表
- **回滚消息**：恢复到指定消息之前的状态

### AI 集成
- 支持 DeepSeek Chat API
- Demo 模式（无 API 密钥时简单回显）
- 完整的对话历史上下文
- 异步处理，快速响应

### 数据持久化
- 自动保存到 JSON 文件
- 异步锁防止并发写入
- 原子操作保证数据完整
- 服务器重启数据不丢失

---

## 🔐 配置

### 环境变量

```bash
# DeepSeek API 配置
DEEPSEEK_API_KEY=your-api-key
DEEPSEEK_API_URL=https://api.deepseek.com/chat/completions
DEEPSEEK_MODEL=deepseek-chat

# 数据存储
PERSISTENCE_FILE=sessions.json
```

---

## 📊 代码统计

| 文件 | 行数 | 说明 |
|------|------|------|
| main.py | ~570 | 后端逻辑（含详细注释） |
| js/app.js | ~330 | 前端应用（含详细注释） |
| js/api.js | ~180 | API 调用（含详细注释） |
| css/main.css | ~450 | 主样式 |
| index.html | ~165 | 前端页面 |
| **总计** | **~1695** | 完整的生产级代码 |

---

## 📚 文档

详细文档请参考：

- **[完整架构文档](./ARCHITECTURE.md)** - 系统设计、数据流、模块说明
- **[快速参考指南](./QUICK_REFERENCE.md)** - 功能速查、API 速查、常见问题

---

## 🎓 代码注释

所有代码都包含详细的中文注释，便于理解：

- ✅ 函数功能说明
- ✅ 参数描述
- ✅ 返回值说明
- ✅ 使用示例
- ✅ 工作流程图
- ✅ 关键业务逻辑解释

---

## 🚀 运行效果

### 完整对话流程

```
1. 用户打开应用
   ↓
2. 加载会话列表
   ↓
3. 创建新会话
   ↓
4. 输入问题
   ↓
5. 立即显示用户消息（乐观更新）
   ↓
6. 后端调用 DeepSeek AI
   ↓
7. 获取 AI 回复，显示在页面上
   ↓
8. 5 秒后消息淡出消失
   ↓
9. 用户可以继续提问、删除、回滚
   ↓
10. 删除会话，完成对话
```

---

## 🔍 性能优化

- ⚡ 异步处理所有 I/O 操作
- 📦 原子文件写入
- 🎯 乐观更新减少等待感
- 🔄 高效的数据结构
- 📱 虚拟 DOM 优化 UI 渲染

---

## 🎯 设计原则

1. **单一职责** - 每个模块只做一件事
2. **关注点分离** - 前后端完全分离
3. **DRY** - 避免重复代码
4. **易测试** - 纯函数无副作用
5. **用户体验** - 快速响应、清晰反馈

---

## 🐛 故障排除

### 常见问题

**Q: 无法连接到后端？**
- A: 检查端口 8000 是否被占用，确认 uvicorn 已启动

**Q: 消息为什么会消失？**
- A: 这是设计功能，AI 回复会在 5 秒后淡出消失

**Q: 数据会丢失吗？**
- A: 不会，所有数据自动保存到 `sessions.json` 文件

**Q: 如何使用真实的 DeepSeek API？**
- A: 设置 `DEEPSEEK_API_KEY` 环境变量并配置 API URL

---

## 📝 示例

### 创建会话

```javascript
// 前端
createNewSession() → API 调用

// 后端
POST /api/sessions
↓
生成唯一 ID → 创建会话对象 → 保存到文件 → 返回会话信息
```

### 发送消息

```javascript
// 前端
sendMsg() → 立即显示用户消息 → 调用 API

// 后端
POST /api/sessions/{id}/messages
↓
验证 → 保存用户消息 → 调用 DeepSeek → 保存 AI 回复 → 返回完整消息列表

// 前端
更新消息列表 → 滚动到底部 → 5 秒后淡出
```

---

## 🎁 扩展建议

### 功能扩展
- [ ] 消息编辑功能
- [ ] 会话搜索
- [ ] 对话导出
- [ ] 消息搜索

### 性能优化
- [ ] 虚拟滚动
- [ ] 消息分页
- [ ] WebSocket 实时更新

### 部署优化
- [ ] Docker 容器化
- [ ] 数据库替代 JSON
- [ ] 用户认证系统
- [ ] 消息加密

---

## 📄 许可证

本项目仅供学习和参考使用。

---

## 👨‍💻 贡献

欢迎提出建议和改进意见！

---

## 📞 支持

如有问题，请查阅：
1. 本 README
2. [完整架构文档](./ARCHITECTURE.md)
3. [快速参考指南](./QUICK_REFERENCE.md)
4. 代码中的详细注释

---

## 🎉 特别感谢

感谢使用本项目！希望这个系统能帮助你更好地理解现代 Web 应用的架构设计。

**项目创建日期**: 2025-11-20  
**最后更新**: 2025-11-20  
**版本**: 1.0 (完全注释版)

---

**让我们一起构建更好的 AI 应用！** 🚀
